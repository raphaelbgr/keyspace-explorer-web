# Story 1.13: Convert Scanner from Modal to Expandable Card with Auto-Navigation

## Status
Draft

## Story
**As a** user exploring the Bitcoin keyspace,
**I want** the scanner to be an expandable card instead of a modal with intelligent auto-navigation features,
**so that** I can seamlessly scan through the keyspace while maintaining context of the main interface and have automated navigation that continues until funds are found.

## Acceptance Criteria
1. Scanner is implemented as an expandable/collapsible card component instead of a modal
2. Scanner card is positioned prominently on the main dashboard
3. Auto-navigation modes: Random Page, Forward Sequential, Backward Sequential
4. Scanner automatically navigates to next page after balance check completion
5. Scanner stops and highlights when any balance > 0 is detected
6. Scanner provides real-time feedback on current scanning progress
7. Scanner can be started/stopped at any time while preserving current page context
8. Scanner integrates with existing balance checking system
9. Scanner maintains session state during scanning operations
10. Scanner shows scanning statistics (pages scanned, time elapsed, current rate)

## Tasks / Subtasks
- [ ] Task 1: Remove modal implementation and create expandable card (AC: 1, 2)
  - [ ] Remove `ScannerModal` component and related modal logic
  - [ ] Create new `ScannerCard` component using Material-UI `Accordion` or `Card` with expand/collapse
  - [ ] Position scanner card prominently on main dashboard
  - [ ] Integrate with existing scanner store state management
- [ ] Task 2: Implement auto-navigation modes (AC: 3, 4)
  - [ ] Add navigation mode selection: Random, Forward, Backward
  - [ ] Implement random page generation using secure random number generation
  - [ ] Implement forward/backward sequential navigation from current page
  - [ ] Add automatic page advancement after balance checking completes
- [ ] Task 3: Implement intelligent stopping logic (AC: 5)
  - [ ] Monitor balance checking results for any address with balance > 0
  - [ ] Stop scanning automatically when funds are detected
  - [ ] Highlight the page/addresses where funds were found
  - [ ] Trigger notification system when funds are discovered
- [ ] Task 4: Add real-time scanning feedback (AC: 6, 10)
  - [ ] Display current page being scanned
  - [ ] Show scanning progress indicators (loading states)
  - [ ] Implement scanning statistics: pages scanned, elapsed time, scan rate
  - [ ] Add visual indicators for scanner status (running/stopped/found funds)
- [ ] Task 5: Integrate scanner controls and session management (AC: 7, 8, 9)
  - [ ] Add start/stop controls with clear visual states
  - [ ] Preserve current page context when scanner starts/stops
  - [ ] Integrate with existing `generatePage` API and balance checking
  - [ ] Maintain scanner session state across page refreshes
- [ ] Task 6: Testing and validation (AC: 1-10)
  - [ ] Test all navigation modes (random, forward, backward)
  - [ ] Verify automatic stopping when funds are detected
  - [ ] Test scanner UI responsiveness and feedback
  - [ ] Validate integration with existing balance checking system

## Dev Notes

### Architecture Context
**Current Implementation:** Modal-based scanner in `ScannerModal.tsx`
**Target Implementation:** Expandable card component integrated into main dashboard
**Store Integration:** Uses `scannerStore` from Zustand for state management

### Previous Story Insights
Scanner currently exists as a modal with basic start/stop functionality. Recent work has established balance checking APIs and notification systems that the new scanner should integrate with.

### Component Structure
**Files to Create/Modify:**
- `apps/web/src/app/components/ScannerCard.tsx` (new expandable card component)
- `apps/web/src/app/page.tsx` (integrate scanner card into main dashboard)
- `apps/web/src/app/store/scannerStore.ts` (enhance with auto-navigation logic)

**Scanner Store Enhancement Required:**
```typescript
interface ScannerState {
  isScanning: boolean;
  scanMode: 'random' | 'forward' | 'backward';
  currentPage: string;
  pagesScanned: number;
  startTime: Date | null;
  scanRate: number; // pages per minute
  lastFoundBalance: any | null;
  // ... existing state
}
```

### Navigation Logic Implementation
**Random Mode:**
- Generate cryptographically secure random page number within valid range
- Use `crypto.getRandomValues()` for randomness
- Ensure generated page is within `[1, totalPages]` range

**Sequential Modes:**
- Forward: `currentPage + 1` (with boundary checking)
- Backward: `currentPage - 1` (with boundary checking)
- Handle BigInt arithmetic using Decimal.js

### Integration Points
**Balance Checking:** Must integrate with existing `/api/generate-page` and balance checking logic
**Notifications:** Should trigger Telegram notifications when funds are found
**Page Navigation:** Must update main dashboard when page changes during scanning

### UI/UX Requirements
**Material-UI Components:**
- `Accordion` or `Card` with `CardHeader` and `Collapse` for expandable behavior
- `LinearProgress` for scanning progress indication
- `Chip` components for scanning statistics
- `IconButton` for start/stop controls
- `RadioGroup` or `ToggleButtonGroup` for mode selection

**Visual States:**
- Collapsed: Show scanner status and quick controls
- Expanded: Show full scanner interface with statistics and controls
- Scanning: Show progress indicators and current page
- Found Funds: Highlight state with balance information

### Testing
**Test File Location:** `apps/web/src/app/components/__tests__/ScannerCard.test.tsx`
**Testing Framework:** Jest + React Testing Library
**Test Cases Required:**
1. Scanner card expand/collapse functionality
2. Navigation mode switching and execution
3. Auto-stopping when balance > 0 detected
4. Statistics calculation accuracy
5. Integration with scanner store state

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-01-18 | 1.0 | Initial story creation for scanner UI conversion and auto-navigation | Bob (SM) |

## Dev Agent Record

### Agent Model Used
[To be filled by dev agent]

### Debug Log References
[To be filled by dev agent]

### Completion Notes List
[To be filled by dev agent]

### File List
[To be filled by dev agent]

## QA Results
[To be filled by QA agent] 