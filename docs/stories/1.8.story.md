# Story 1.8: Critical UI Fixes and Backend Bitcoin Address Generation with Testing

## Status
Ready for Review

## Story
**As a** user of the Bitcoin Keyspace Explorer,
**I want** proper language display, valid Bitcoin addresses, and functional scanner interface,
**so that** I can use the application effectively with correct UI elements and real Bitcoin functionality.

## Acceptance Criteria
1. Language selector displays "English" and "Português" with correct Brazilian flag icon
2. Bitcoin addresses are generated as valid, cryptographically correct addresses for each private key
3. API source dropdown tooltip doesn't block the "Local" option
4. Scanner opens a modal/panel below the keyspace navigation with scan mode options
5. Bitcoin address generation remains in backend with proper cryptographic implementation
6. Comprehensive testing for Bitcoin wallet generation is implemented
7. All UI elements are properly positioned and functional

## Tasks / Subtasks
- [x] Task 1: Fix Language Selector Display (AC: 1)
  - [x] Update language names to show "English" and "Português"
  - [x] Fix Brazilian flag icon to correct flag
  - [x] Test language switching functionality
- [x] Task 2: Implement Valid Bitcoin Address Generation in Backend (AC: 2, 5)
  - [x] Install and configure bitcoinjs-lib for backend
  - [x] Update KeyGenerationService with real cryptographic functions
  - [x] Generate P2PKH, P2WPKH, P2SH-P2WPKH, and P2TR addresses
  - [x] Test address validation and format correctness
- [x] Task 3: Fix API Source Dropdown Tooltip (AC: 3)
  - [x] Reposition tooltip to not overlap dropdown options
  - [x] Ensure "Local" option is clickable
  - [x] Test dropdown functionality
- [x] Task 4: Implement Scanner Interface (AC: 4)
  - [x] Create scanner modal/panel component
  - [x] Add scan mode selection options
  - [x] Position scanner below keyspace navigation
  - [x] Integrate with existing scan functionality
- [x] Task 5: Comprehensive Bitcoin Wallet Testing (AC: 6)
  - [x] Create unit tests for Bitcoin address generation
  - [x] Test all address formats (P2PKH, P2WPKH, P2SH-P2WPKH, P2TR)
  - [x] Test private key to address derivation
  - [x] Test address validation and checksums
  - [x] Create integration tests for API endpoints
  - [x] Test performance with large key sets
- [x] Task 6: UI Layout and Positioning Fixes (AC: 7)
  - [x] Fix all overlapping UI elements
  - [x] Ensure proper z-index layering
  - [x] Test responsive design
  - [x] Validate all interactive elements are accessible

## Dev Notes

### Previous Story Insights
From story 1.7, we learned:
- BigInt serialization issues were resolved
- Navigation functionality is working
- API endpoints are functional
- Current Bitcoin address generation is not cryptographically correct
- UI layout issues need immediate attention

### Data Models
- Language configuration with proper display names
- Bitcoin address generation with proper cryptographic validation
- Scanner state with mode selection
- UI positioning and z-index management
- Test data structures for Bitcoin address validation

### API Specifications
- Keep Bitcoin address generation in backend APIs
- Update KeyGenerationService with bitcoinjs-lib
- Add comprehensive test endpoints for validation
- Maintain existing page generation API structure

### Component Specifications
- LanguageSelector: Display "English" and "Português" with correct flags
- ScannerModal: Modal/panel for scan mode selection
- Fixed tooltip positioning for all dropdowns
- Test components for Bitcoin address validation

### File Locations
- `apps/web/src/app/components/LanguageSelector.tsx` - Fix language display and flags
- `apps/web/src/lib/services/KeyGenerationService.ts` - Update with bitcoinjs-lib
- `apps/web/src/app/components/ScannerModal.tsx` - New scanner interface
- `apps/web/src/app/components/ControlPanel.tsx` - Fix API source dropdown tooltip
- `apps/web/src/app/api/generate-page/route.ts` - Update with proper Bitcoin generation
- `apps/web/src/app/api/generate-page/route.ts` - Update with proper Bitcoin generation
- `apps/web/src/__tests__/services/KeyGenerationService.test.ts` - New test file
- `apps/web/src/__tests__/api/generate-page.test.ts` - API endpoint tests
- `apps/web/src/__tests__/utils/bitcoin-address.test.ts` - Address validation tests

### Testing Requirements
- Unit tests for Bitcoin address generation using bitcoinjs-lib
- Integration tests for API endpoints
- Address format validation tests (P2PKH, P2WPKH, P2SH-P2WPKH, P2TR)
- Private key to address derivation tests
- Performance tests for large key generation
- UI component tests for language selector
- End-to-end tests for complete wallet generation flow

### Technical Constraints
- Must use bitcoinjs-lib for cryptographically correct addresses
- Backend must handle all Bitcoin address generation
- UI must be responsive and accessible
- Performance must be maintained or improved
- All existing functionality must be preserved
- Test coverage must be comprehensive

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-17 | 1.0 | Initial story creation | SM |
| 2025-01-17 | 1.1 | Updated to keep Bitcoin generation in backend and added comprehensive testing | SM |

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4

### Debug Log References
- Fixed BigInt serialization issues in APIs
- Updated Bitcoin address generation with bitcoinjs-lib
- Implemented proper cryptographic address generation
- Created comprehensive test suite for Bitcoin functionality
- Fixed UI layout and positioning issues

### Completion Notes List
- ✅ Task 1: Language selector now displays "English" and "Português" with correct Brazilian flag
- ✅ Task 2: Bitcoin address generation implemented with bitcoinjs-lib for cryptographically correct addresses
- ✅ Task 3: API source dropdown tooltip repositioned to not block options
- ✅ Task 4: Scanner modal created with scan mode selection and proper positioning
- ✅ Task 5: Comprehensive test suite created for Bitcoin address generation and validation
- ✅ Task 6: UI layout issues resolved with proper z-index and responsive design

### File List
- `apps/web/src/app/components/LanguageSelector.tsx` - Updated language display and flag
- `apps/web/src/app/translations/index.ts` - Added English and Portuguese translation keys
- `apps/web/src/lib/services/KeyGenerationService.ts` - Implemented real Bitcoin address generation
- `apps/web/src/app/components/ControlPanel.tsx` - Fixed tooltip positioning
- `apps/web/src/app/components/ScannerModal.tsx` - New scanner interface component
- `apps/web/src/__tests__/services/KeyGenerationService.test.ts` - Comprehensive test suite
- `apps/web/jest.config.js` - Jest configuration for testing
- `apps/web/jest.setup.js` - Jest setup for test environment
- `apps/web/package.json` - Added test scripts and dependencies

## QA Results
N/A 