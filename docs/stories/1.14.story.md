# Story 1.14: Fix Number Display Format in Advanced Navigation

## Status
Draft

## Story
**As a** user navigating through large page numbers in the Bitcoin keyspace,
**I want** to see page numbers and navigation inputs in normal decimal notation instead of scientific notation,
**so that** I can easily read and understand the exact page numbers I'm working with.

## Acceptance Criteria
1. Advanced navigation "Go to page" input displays numbers in normal decimal format (e.g., "123456789" not "1.23e+8")
2. Current page display shows full decimal notation for all page numbers
3. Page range indicators show readable decimal format (e.g., "1 - 2,573,157,538,607...")
4. Number formatting includes appropriate thousands separators for readability
5. Input field accepts and parses decimal notation correctly
6. Copy-paste functionality works with both decimal and scientific notation inputs
7. Large numbers remain readable without losing precision
8. Consistent decimal formatting across all navigation components

## Tasks / Subtasks
- [ ] Task 1: Identify scientific notation display issues (AC: 1, 2, 3)
  - [ ] Audit `AdvancedNavigation.tsx` component for number display
  - [ ] Review `KeyspaceSlider.tsx` number formatting
  - [ ] Identify all locations showing scientific notation
  - [ ] Document current `formatNumber` function behavior
- [ ] Task 2: Implement decimal-only number formatting (AC: 1, 2, 3, 4, 7)
  - [ ] Create or enhance `formatDecimalNumber` utility function
  - [ ] Add thousands separators for readability (e.g., "1,234,567,890")
  - [ ] Ensure no scientific notation is used regardless of number size
  - [ ] Handle BigInt and Decimal.js number types correctly
- [ ] Task 3: Update input field handling (AC: 5, 6)
  - [ ] Modify input parsing to accept decimal notation
  - [ ] Add support for comma-separated input (strip commas before parsing)
  - [ ] Maintain compatibility with scientific notation input for edge cases
  - [ ] Add input validation for decimal format
- [ ] Task 4: Apply consistent formatting across navigation components (AC: 8)
  - [ ] Update `AdvancedNavigation.tsx` "Go to page" input display
  - [ ] Update `KeyspaceSlider.tsx` current page display
  - [ ] Update page range indicators and tooltips
  - [ ] Ensure consistency in `formatNumber` utility usage
- [ ] Task 5: Testing and validation (AC: 1-8)
  - [ ] Test with various large page numbers (near keyspace limits)
  - [ ] Verify thousands separators appear correctly
  - [ ] Test input parsing with different decimal formats
  - [ ] Validate no precision loss with BigInt operations

## Dev Notes

### Architecture Context
**Components Affected:**
- `apps/web/src/app/components/AdvancedNavigation.tsx`
- `apps/web/src/app/components/KeyspaceSlider.tsx`
- Shared utility functions for number formatting

**Current Issue:** Large page numbers are being displayed in scientific notation (e.g., "1.23e+15") instead of full decimal format.

### Previous Story Insights
Recent slider work implemented Decimal.js for BigInt precision. The `formatNumber` utility currently uses JavaScript's native number formatting which defaults to scientific notation for large numbers.

### Technical Requirements
**Current Problematic formatNumber Function:**
The current implementation likely uses `Number()` conversion which triggers scientific notation for large values.

**Required New Implementation:**
```typescript
const formatDecimalNumber = (num: string | number | bigint | Decimal): string => {
  // Convert to Decimal for precision
  const decimal = new Decimal(num.toString());
  
  // Format with thousands separators, no scientific notation
  const formatted = decimal.toFixed(0);
  
  // Add thousands separators
  return formatted.replace(/\B(?=(\d{3})+(?!\d))/g, ',');
};
```

**Input Parsing Enhancement:**
```typescript
const parseDecimalInput = (input: string): string => {
  // Remove thousands separators
  const cleaned = input.replace(/,/g, '');
  
  // Handle scientific notation if provided
  if (cleaned.includes('e') || cleaned.includes('E')) {
    return new Decimal(cleaned).toFixed(0);
  }
  
  // Return cleaned decimal string
  return cleaned;
};
```

### Component Integration Points
**AdvancedNavigation.tsx:**
- "Go to page" `TextField` value display
- Current page range indicators
- Tooltips showing page boundaries

**KeyspaceSlider.tsx:**
- Current page display in navigation header
- Slider tooltip showing target page numbers
- Page range indicators (1 - maximum)

### Data Models
**Number Types Used:**
- `currentPage`: string (BigInt-safe)
- `totalPages`: BigInt or string
- `Decimal` objects for calculations
- Native `number` for display formatting

### Testing
**Test File Locations:**
- `apps/web/src/app/components/__tests__/AdvancedNavigation.test.tsx`
- `apps/web/src/app/components/__tests__/KeyspaceSlider.test.tsx`
- `apps/web/src/app/utils/__tests__/numberFormatting.test.tsx`

**Testing Framework:** Jest + React Testing Library
**Test Cases Required:**
1. Large number decimal formatting (no scientific notation)
2. Thousands separator placement accuracy
3. Input parsing with various decimal formats
4. BigInt/Decimal precision maintenance
5. Cross-component formatting consistency

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-01-18 | 1.0 | Initial story creation for decimal number display formatting | Bob (SM) |

## Dev Agent Record

### Agent Model Used
[To be filled by dev agent]

### Debug Log References
[To be filled by dev agent]

### Completion Notes List
[To be filled by dev agent]

### File List
[To be filled by dev agent]

## QA Results
[To be filled by QA agent] 