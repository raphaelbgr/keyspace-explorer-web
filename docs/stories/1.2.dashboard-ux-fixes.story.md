# Story 1.2: Dashboard UX/UI Critical Fixes

## Status
Draft

## Story
**As a** user of the Bitcoin Keyspace Explorer dashboard,
**I want** a fully functional, responsive, and user-friendly interface
**so that** I can efficiently explore the Bitcoin keyspace with proper dark mode persistence, complete key display, working scan functionality, and optimal performance.

## Acceptance Criteria
1. Dark mode toggle persists across page refreshes (F5) and properly applies to all UI elements
2. Dashboard automatically loads the first page (page 1) on initial load
3. All 45 keys are displayed in a scrollable list format with full private keys visible in small font
4. API source selector (Local/Blockstream) is added with Local as default
5. Scan functionality works correctly with proper XHR calls visible in browser dev tools
6. Dashboard is fully responsive and performs well on all device sizes
7. All animations and transitions are smooth and optimized for performance

## Tasks / Subtasks

### Task 1: Fix Dark Mode Persistence and UI Coverage (AC: 1)
- [ ] Fix Zustand store persistence to localStorage
- [ ] Ensure dark mode applies to all Material-UI components
- [ ] Add proper CSS variables for dark mode colors
- [ ] Test dark mode persistence across browser sessions
- [ ] Verify all UI elements are properly themed in dark mode

### Task 2: Implement Auto-Load First Page (AC: 2)
- [ ] Add useEffect to load page 1 on component mount
- [ ] Implement loading state while fetching initial page
- [ ] Handle errors gracefully during initial load
- [ ] Update page number input to reflect loaded page

### Task 3: Redesign Key Display Layout (AC: 3)
- [ ] Replace current 6-key grid with scrollable list
- [ ] Display all 45 keys in compact format
- [ ] Show full private key in small monospace font
- [ ] Add proper spacing and visual hierarchy
- [ ] Implement virtual scrolling for performance if needed

### Task 4: Add API Source Selector (AC: 4)
- [ ] Create toggle/radio button for Local vs Blockstream API
- [ ] Set Local as default selection
- [ ] Update API calls to use selected source
- [ ] Add visual indicator of current API source
- [ ] Persist API source preference in localStorage

### Task 5: Fix Scan Functionality (AC: 5)
- [ ] Implement proper scan API endpoint calls
- [ ] Add real XHR requests visible in browser dev tools
- [ ] Create proper scan session management
- [ ] Add progress tracking and real-time updates
- [ ] Implement proper error handling for scan operations

### Task 6: Optimize Responsiveness and Performance (AC: 6, 7)
- [ ] Audit and optimize component rendering
- [ ] Implement proper lazy loading for large datasets
- [ ] Add performance monitoring and optimization
- [ ] Test and fix responsive breakpoints
- [ ] Optimize animations and transitions
- [ ] Add loading states and skeleton screens

## Dev Notes

### Previous Story Insights
From the initial dashboard implementation, we learned:
- Material-UI components need explicit theme integration for dark mode
- Zustand store needs proper hydration for SSR compatibility
- Large key datasets require virtualization for performance
- API calls need proper error boundaries and loading states

### Data Models
- PageData interface from `src/lib/types/keys.ts`
- ScanSession interface for managing scan state
- ThemeState interface for dark mode persistence

### API Specifications
- `/api/generate-page` - POST with pageNumber
- `/api/balances` - POST with addresses array and source parameter
- `/api/scan/start` - POST to initiate scan session
- `/api/scan/stop` - POST to stop scan session
- `/api/scan/status` - GET to check scan progress

### Component Specifications
- Dashboard component needs proper state management for:
  - Current page data
  - Scan session state
  - API source preference
  - Theme mode
- KeyList component for displaying 45 keys in scrollable format
- ScanControls component for scan start/stop functionality
- APISelector component for Local/Blockstream toggle

### File Locations
- `src/app/page.tsx` - Main dashboard component
- `src/app/store/themeStore.ts` - Dark mode state management
- `src/app/components/KeyList.tsx` - New component for key display
- `src/app/components/ScanControls.tsx` - New component for scan controls
- `src/app/components/APISelector.tsx` - New component for API selection
- `src/app/api/scan/` - New API routes for scan functionality

### Testing Requirements
- Unit tests for all new components
- Integration tests for API calls
- E2E tests for scan functionality
- Performance tests for large key datasets
- Accessibility tests for dark mode and responsive design

### Technical Constraints
- Must maintain compatibility with existing API structure
- Performance target: < 2s for page generation, < 5s for balance queries
- Must work on mobile devices (320px+ viewport)
- Must support keyboard navigation and screen readers
- Must handle network errors gracefully

## Testing
- Test dark mode persistence across browser sessions
- Test auto-load functionality on fresh page visits
- Test key display with various page sizes
- Test API source switching functionality
- Test scan functionality with browser dev tools monitoring
- Test responsive design on multiple device sizes
- Performance testing with large datasets

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2024-01-17 | 1.0 | Initial story creation | Bob (SM) |

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4

### Debug Log References
- Dashboard performance issues identified
- Dark mode persistence problems documented
- Scan functionality not working properly
- Responsive design issues on mobile

### Completion Notes List
*To be populated by Dev Agent during implementation*

### File List
*To be populated by Dev Agent during implementation*

## QA Results
*To be populated by QA Agent after implementation* 